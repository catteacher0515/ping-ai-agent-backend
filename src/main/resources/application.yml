# ========================================================================
# 案件: 全局配置 (Nuclear Option)
# 策略: 覆盖所有可能的配置路径，确保 Key 绝对能被读取
# ========================================================================

spring:
  application:
    name: ping-ai-agent

  # ------------------------------------------------------------------------
  # 路径 1: 标准 Spring AI Alibaba 配置 (修正版)
  # ------------------------------------------------------------------------
  ai:
    dashscope:
      api-key: ${DASHSCOPE_API_KEY}
      chat:
        options:
          model: qwen-plus

    # [核心修复] MCP 客户端配置
    mcp:
      client:
        enabled: true      # <--- 1. 必须显式开启！
        type: SYNC         # <--- 2. 必须指定是同步 (SYNC) 还是异步 (ASYNC)
        name: ping-agent-client # (可选) 给客户端起个名
        version: 1.0.0          # (可选) 版本号
        stdio:
          # 指定 MCP 配置文件路径
          servers-configuration: classpath:mcp-servers.json
    
    # 向量数据库配置 (保持不变)
    vectorstore:
      pgvector:
        index-type: HNSW
        distance-type: COSINE_DISTANCE
        max-document-batch-size: 10000

  # ------------------------------------------------------------------------
  # 路径 2: 防御性配置 (防止某些版本读取 spring.cloud.ai)
  # ------------------------------------------------------------------------
  cloud:
    ai:
      dashscope:
        api-key: ${DASHSCOPE_API_KEY}

  # ------------------------------------------------------------------------
  # 数据库配置
  # ------------------------------------------------------------------------
  datasource:
    # 格式：jdbc:postgresql://[外网地址]:[端口]/[数据库名]
    url: jdbc:postgresql://pgm-bp1102ca3fsas6a84o.rwlb.rds.aliyuncs.com:5432/ping_agent
    username: ping_user
    password: 1122336qwQW
    driver-class-name: org.postgresql.Driver

# 邮件配置
#email:
#  host: smtp.gmail.com
#  port: 587
#  username: maomilaoshi0515@gmail.com
#  # 关键: 密码必须从环境变量读取
#  password: ${EMAIL_PASSWORD}
#  ssl: false
#  starttls: true

# 案件 Tool-009: 邮件配置 (QQ 专用版)
email:
  host: smtp.qq.com
  port: 465
  username: 2726784816@qq.com  # ✅ 确认是这个
  password: ${EMAIL_PASSWORD}
  ssl: true

# ========================================================================
# 案件 Tool-003: 联网搜索配置 (独立根节点)
# ========================================================================
search-api:
  # SearchAPI Key (用于 WebSearchTool)
  api-key: ${SEARCH_API_KEY}

# ========================================================================
# 路径 3: 遗留兼容性配置 (用于你的 AiService.java 等旧代码)
# ========================================================================
aliyun:
  dashscope:
    api-key: sk-1f3bc420038b41e9a40c235991003971

# ========================================================================
# Web 服务配置
# ========================================================================
server:
  port: 8080
  servlet:
    context-path: /api

# ========================================================================
# 文档工具配置 (Swagger/Knife4j)
# ========================================================================
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: 'default'
      paths-to-match: '/**'
      packages-to-scan: com.pingyu.pingaiagent.controller

knife4j:
  enable: true
  setting:
    language: zh_cn